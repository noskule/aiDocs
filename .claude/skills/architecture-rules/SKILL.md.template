---
name: architecture-rules
description: Enforces architecture principles when implementing features or writing new code. Prevents code duplication and layer violations.
user-invocable: false
---

## Before Writing Code

1. **Read** `docs/[platform]-architecture-rules.md`
2. **Search before implementing** — check the Reuse Rules tables for existing utilities. If the function you need exists, use it.
3. **Verify layer boundaries** — ensure imports respect the documented dependency direction
4. **Check extension points** — if adding a new type, metric, or protocol, use the documented extension mechanism
5. **Check anti-patterns** — review the anti-patterns table to avoid common mistakes
6. **Use constants** — never hard-code values that belong in a constants class

## After Completing Your Task

Spawn a background subagent to scan for architecture violations. Use the **Task tool** with these exact parameters:

- `subagent_type`: `Explore`
- `run_in_background`: `true`
- `prompt`: (include the file list and instructions below)

```
Review these files for architecture rule violations against docs/[platform]-architecture-rules.md:
[list the files you read/modified]

For each file, check:
- Layer boundary violations (wrong imports across layers)
- Hard-coded values that should use a constants class
- Duplicated logic that exists in the Reuse Rules table
- Anti-patterns from the anti-patterns table

Output a concise violation report. Group by severity:
- **Must fix** — active violations that cause bugs or inconsistency
- **Should fix** — technical debt worth addressing
- **Note** — minor style issues

If no violations found, report "No violations detected."
```
